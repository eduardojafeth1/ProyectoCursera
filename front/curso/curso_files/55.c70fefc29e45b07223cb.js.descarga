(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{"jq+c":function(module,e,r){"use strict";r.r(e);var t=r("VbXa"),n=r.n(t),a=r("q1tI"),o=r("S+eF"),s=r.n(o),c=r("DnuM"),i=r("sQ/U"),u=r("F/us"),l=r.n(u),d=r("8kE/"),h=r("15pW"),p=r("TSOT"),m=Object(p.a)(h.a.coursesApi,{type:"rest"}),f=r("uJqh"),E=r("PJYZ"),g=r.n(E),v=r("oShl"),b=function(e){function JSApplicationError(r){var t;return(t=e.call(this)||this).context=null,Error.captureStackTrace&&Error.captureStackTrace(g()(t),JSApplicationError),t.name="JSApplicationError",t.message=r,t.context=null,t.detail=null,t}return n()(JSApplicationError,e),JSApplicationError.fromError=function(e){var r;if("string"==typeof e)r=new JSApplicationError(e);else if(null!=e)if(null!=e.message)(r=new JSApplicationError(e.message)).stack=e.stack,r.detail=Object.assign({},e);else try{var t=JSON.stringify(e);r=new JSApplicationError("Object thrown as error: ".concat(t,". Please throw an actual Error instead."))}catch(t){r="TypeError"===t.name?new JSApplicationError("Cyclic object thrown/rejected as an error. Please throw an actual Error instead."):new JSApplicationError("Object thrown as error (".concat(e,") that could not be stringified (").concat(t,"). Please throw an actual Error instead."))}else r=new JSApplicationError("`undefined` or `null` thrown/rejected. Did you mean to throw/reject an Error object?");return r},JSApplicationError}(r.n(v)()(Error)),w=["instructorIds","partnerIds","_links"].join(","),y=["brandingImage","certificatePurchaseEnabledAt","partners.v1(squareLogo,rectangularLogo)","instructors.v1(fullName)","overridePartnerLogos","sessionsEnabledAt","domainTypes","premiumExperienceVariant","isRestrictedMembership"].join(","),courseData_getCourse=function(e){if(!e.elements)throw new b("Course data missing from response");var r=e.elements[0];return r.instructors=l()(r.instructorIds).map((function(r){return e.getLinkedObject("instructors.v1",r)})),r.universities=l()(r.partnerIds).map((function(r){return e.getLinkedObject("partners.v1",r)})),r},L={fromSlug:Object(d.a)((function(e){return e?s()(m.get("",{data:{q:"slug",slug:e&&e.toLowerCase(),includes:w,fields:y}})).then(f.a).then(courseData_getCourse):s.a.reject("Missing courseSlug argument")})),fromId:Object(d.a)((function(e){return e?s()(m.get(e,{data:{includes:w,fields:y}})).then(f.a).then(courseData_getCourse):s.a.reject("Missing courseId argument")}))},R=r("fw5G"),N=r.n(R),A=Object(p.a)(h.a.openCourseMembershipApi,{type:"rest"}),j=r("welz"),S=r.n(j),k=r("vlZc"),C=r.n(k),T=r("qiY+"),B=C.a.AssociatedModel.extend({api:A,defaults:function(){return{timestamp:Date.now()}},initialize:function(e){if(!l()(e).has("courseId"))throw new Error("You must instantiate a Membership with a courseId");this.get("userId")||this.set("userId",e.userId||i.a.get().id),l()(e).has("id")||this.set("id",this.get("userId")+"~"+this.get("courseId"),{silent:!0})},hasTeachingRole:function(){return l()(h.a.courseRolesWithTeachAccess).contains(this.get("courseRole").toUpperCase())},hasModerationRole:function(){return l()(h.a.courseRolesWithModeratorAccess).contains(this.get("courseRole").toUpperCase())},hasEnrolledRole:function(){return!l()([T.a.BROWSER,T.a.NOT_ENROLLED,T.a.PRE_ENROLLED_LEARNER]).contains(this.get("courseRole"))},hasPreEnrolled:function(){return this.get("courseRole")===T.a.PRE_ENROLLED_LEARNER},enroll:function(e){this.set("courseRole",e||T.a.LEARNER);var r={data:this.toJSON()};return s()(this.api.post("",r))},unenroll:function(){return this.set("courseRole",T.a.NOT_ENROLLED),s()(this.api.delete(this.get("id")))}},T.a),I=S.a.Collection.extend({model:B,getEnrolled:function(){return this.filter((function(e){return e.get("courseRole")!==B.NOT_ENROLLED}))}}),promises_memberships=function(e){var r=function(e){var r=(new N.a).addQueryParam("q","findByUser").addQueryParam("userId",e);return s()(A.get(r.toString()))}(e).then((function(e){return new I(e.elements)}));return r.done(),r},O=r("8li0"),D=Object(c.a)("/api/reports.v1",{type:"rest"}),J="teachVisitedAt",M=10080;function getBannerData(){return function(){var e=i.a.get().id;if(!e)return s.a.reject();return promises_memberships(e).then((function(e){var r=e.find((function(e){return e.hasTeachingRole()}));if(r&&"UNIVERSITY_ADMIN"!==r.get("courseRole")){var t=r.get("courseId");return[r,L.fromId(t)]}return s.a.reject()})).spread((function(e,r){return O.a.isLaunched(r)?[e,r]:s.a.reject()}))}().spread((function(e,r){return[e,r,getLearnerCounts(e,r)]}))}function shouldShow(){var e=localStorage[J];if(e){var r=new Date(parseInt(e)),t=new Date(Date.now());return 60*t.getHours()+t.getMinutes()-(60*r.getHours()+r.getMinutes())>M}return!0}function getLearnerCounts(e,r){return s()(D.get("Course~".concat(r.id,"~activity_learner_counts"))).then((function(t){return function(e){return e.elements&&e.elements[0]&&e.elements[0].body&&e.elements[0].body.latest&&e.elements[0].body.latest.starter_ever_count&&e.elements[0].body.latest.active_learner_past_1w_count&&e.elements[0].body.latest.visitor_ever_count&&e.elements[0].body["1w_ago"]&&e.elements[0].body["1w_ago"].starter_ever_count}(t)?t.elements[0].body:s.a.reject({membership:e,course:r})}))}r("wab5");var W,q=r("17x9"),x=r.n(q),P=r("kvW3"),V=function(e){function TotalLearnerBanner(){return e.apply(this,arguments)||this}return n()(TotalLearnerBanner,e),TotalLearnerBanner.prototype.render=function(){var e=this.props.course,r=e.name,t="/teach/".concat(e.slug),n=this.props.learnerCounts.latest.visitor_ever_count;return a.createElement("div",{className:"rc-TotalLearnerBanner"},"A total of"," ",a.createElement("a",{href:t},a.createElement("strong",{className:"c-teach-banner-learner-count"},a.createElement(P.c,{value:n})," learners"))," ","are enrolled in ",a.createElement("span",{className:"c-teach-banner-course-name"},r),". View more on the"," ",a.createElement("a",{href:t},W||(W=a.createElement("strong",null,"Course Dashboard."))))},TotalLearnerBanner}(a.Component);V.propTypes={course:x.a.object.isRequired,learnerCounts:x.a.object.isRequired};var U,Y=V,Q=function(e){function WeeklyActiveLearnerBanner(){return e.apply(this,arguments)||this}return n()(WeeklyActiveLearnerBanner,e),WeeklyActiveLearnerBanner.prototype.render=function(){var e=this.props.course,r=e.name,t="/teach/".concat(e.slug),n=this.props.learnerCounts.latest.active_learner_past_1w_count;return a.createElement("div",{className:"rc-WeeklyActiveLearnerBanner"},a.createElement("a",{href:t},a.createElement("strong",{className:"c-teach-banner-learner-count"},a.createElement(P.c,{value:n})," learners"))," ","were active in ",a.createElement("span",{className:"c-teach-banner-course-name"},r)," in the past week. View more on the"," ",a.createElement("a",{href:t},U||(U=a.createElement("strong",null,"Course Dashboard."))))},WeeklyActiveLearnerBanner}(a.Component);Q.propTypes={course:x.a.object.isRequired,learnerCounts:x.a.object.isRequired};var z,F=Q,H=function(e){function WeeklyNewLearnerBanner(){return e.apply(this,arguments)||this}return n()(WeeklyNewLearnerBanner,e),WeeklyNewLearnerBanner.prototype.render=function(){var e,r=this.props.course,t=r.name,n="/teach/".concat(r.slug),o=(e=this.props.learnerCounts).latest.starter_ever_count-e["1w_ago"].starter_ever_count;return a.createElement("div",{className:"rc-WeeklyNewLearnerBanner"},a.createElement("a",{href:n},a.createElement("strong",{className:"c-teach-banner-learner-count"},a.createElement(P.c,{value:o})," learners"))," ","enrolled in ",a.createElement("span",{className:"c-teach-banner-course-name"},t)," in the past week. View more on the"," ",a.createElement("a",{href:n},z||(z=a.createElement("strong",null,"Course Dashboard."))))},WeeklyNewLearnerBanner}(a.Component);H.propTypes={course:x.a.object.isRequired,learnerCounts:x.a.object.isRequired};var Z,G,X=[{key:"weeklyActiveLearner",component:F},{key:"weeklyNewLearner",component:H},{key:"totalLearner",component:Y}],K=function(e){function TeachBanner(){for(var r,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(r=e.call.apply(e,[this].concat(n))||this).state={course:null,membership:null,learnerCounts:{},bannerIndex:-1,dismissed:!1},r.handleDismiss=function(){localStorage[J]=Date.now(),r.setState({dismissed:!0})},r}n()(TeachBanner,e);var r=TeachBanner.prototype;return r.componentDidMount=function(){var e=this;getBannerData().spread((function(r,t,n){var a=Math.round(Math.random()*(X.length-1));e.setState({course:t,membership:r,learnerCounts:n,bannerIndex:a})})).catch((function(){})).done()},r.renderBanner=function(){var e=X[this.state.bannerIndex].component;return(a.createElement(e,{course:this.state.course,learnerCounts:this.state.learnerCounts}))},r.render=function(){return this.state.course&&!this.state.dismissed&&shouldShow()?a.createElement("div",{className:"rc-TeachBanner bt3-alert bt3-alert-info bt3-alert-dismissable"},a.createElement("div",{className:"c-teach-banner-content"},a.createElement("button",{onClick:this.handleDismiss,className:"bt3-close","data-dismiss":"alert","aria-label":"Close"},G||(G=a.createElement("span",{"aria-hidden":"true"},"Ã—"))),this.renderBanner())):Z||(Z=a.createElement("div",null))},TeachBanner}(a.Component);e.default=K},wab5:function(module,exports,e){e("xTv4")},xTv4:function(module,exports,e){}}]);
//# sourceMappingURL=55.c70fefc29e45b07223cb.js.map